[package]
name = "mytest"
description = "So apparently this needs to be longer or Lintian gets unhappy."
version = "0.1.0"
edition = "2021"
authors = ["This Needs To Be A Name <and_an@email.address>"]

# Per https://doc.rust-lang.org/cargo/reference/manifest.html#the-license-and-license-file-fields
# this must be one of the short IDs at https://github.com/spdx/license-list-data/blob/v3.11/licenses.md
license = "BSD-3-Clause"


[dependencies]


[package.metadata.deb]
name = "mytest"
priority = "optional"
section = "net"
extended-description-file = "pkg/debian/description.txt"
license-file = ["LICENSE", "0"]
depends = "$auto, passwd, libssl1.1" # your application/(pre|post|un)install script dependencies
maintainer-scripts = "pkg/debian/"
changelog = "target/debian/changelog" # this will be generated by the pkg workflow
copyright = "Copyright (c) 2022, Your Company. All rights reserved."
assets = [
    ["target/release/mytest", "/usr/bin/mytest", "755"],
]
systemd-units = { unit-name = "mytest", unit-scripts = "pkg/common", enable = true }


[package.metadata.deb.variants.ubuntu-jammy]
depends = "$auto, passwd, libssl3"


[package.metadata.deb.variants.debian-buster-arm-unknown-linux-gnueabihf]
depends = "adduser, passwd, libc6 (>= 2.28), libssl1.1"


[package.metadata.deb.variants.minimal]
depends = "libc, rsync" # a deliberately different dependency that we can test for on older O/S's.


[package.metadata.generate-rpm]
# "BSD" is the 3-clause license. Inheriting "license" from above causes rpmlint to complain with "invalid-license".
# See: https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing
license = "BSD"

assets = [
    { source = "target/release/mytest", dest = "/usr/bin/mytest", mode = "755" },

    # For DEB packages the service unit file is detected and handled automatically, but for RPM packages we have to
    # add it manually as an asset. To support different service unit files for different "variants" defined in this
    # file the NLnet Labs Rust Cargo Packaging workflow copies the file specified by setting `systemd_service_unit_file`
    # variable in the `package_build_rules` matrix to `target/rpm/mytest.*` (where `pkg` is also a matrix variable).
    { source = "target/rpm/mytest.mytest.service", dest = "/lib/systemd/system/mytest.service", mode = "644" },
    { source = "target/rpm/mytest.mytest.timer", dest = "/lib/systemd/system/mytest.timer", mode = "644" },
]
# These get set using cargo-generate-rpm --set-metadata at package build time.
#post_install_script = ...
#pre_uninstall_script = ...
#post_uninstall_script = ...


# ensure that the useradd is present by requiring the package that provides it
[package.metadata.generate-rpm.requires]
shadow-utils = "*"
